<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>주은혜 찬양사역팀 매니저 Pro</title>
    
    <!-- 필수 라이브러리 (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #4834d4; --bg: #f8faff; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: #333; -webkit-tap-highlight-color: transparent; margin: 0; overflow: hidden; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .scale-in { animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .progress-bar-fill { transition: width 0.3s ease-in-out; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root">
        <!-- 초기 로딩 화면 -->
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: #4834d4;">
            <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #4834d4; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: 20px; font-weight: bold; font-family: sans-serif;">시스템 연결 중...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, setDoc, addDoc, deleteDoc, query, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDribbbOpi9VcnLu3szJZnT06R4dhx9eww",
            authDomain: "onnuri-grace.firebaseapp.com",
            projectId: "onnuri-grace",
            storageBucket: "onnuri-grace.firebasestorage.app",
            messagingSenderId: "349044849326",
            appId: "1:349044849326:web:8fa00da5f4a81eff318b3f",
            measurementId: "G-BMQYDH77QX"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            window.FB_READY = true;
            window.MyFirebase = { auth, db, doc, collection, onSnapshot, setDoc, addDoc, deleteDoc, query, getDoc, signInAnonymously, signInWithCustomToken, onAuthStateChanged };
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (e) {
            console.error("Firebase Init Error", e);
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const MASTER_PASSWORD = "onnurigrace";
        const SHARE_LINK = "https://jongsungjoo.github.io/grace/";
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'grace-manager-v2';

        // 1. 윤용한 삭제됨
        const INITIAL_MEMBERS = [
            { name: "박용규", part: "staff", status: "active", role: "성가사" },
            { name: "도은경", part: "staff", status: "active", role: "반주자" },
            { name: "기민정", part: "soprano", status: "active" }, { name: "김수진", part: "soprano", status: "active" },
            { name: "김순화", part: "soprano", status: "active" }, { name: "김오남", part: "soprano", status: "active" },
            { name: "김용순", part: "soprano", status: "active" }, { name: "김인숙", part: "soprano", status: "active" },
            { name: "김자선", part: "soprano", status: "active" }, { name: "김지애", part: "soprano", status: "active" },
            { name: "김지혜", part: "soprano", status: "active" }, { name: "김혜정", part: "soprano", status: "active" },
            { name: "남혜경", part: "soprano", status: "active" }, { name: "서은정", part: "soprano", status: "active" },
            { name: "신은아", part: "soprano", status: "active" }, { name: "신현수", part: "soprano", status: "active" },
            { name: "오현주", part: "soprano", status: "active" }, { name: "우연경", part: "soprano", status: "active" },
            { name: "이선민", part: "soprano", status: "active" }, { name: "이현희", part: "soprano", status: "active" },
            { name: "정혜림", part: "soprano", status: "active" }, { name: "정혜영", part: "soprano", status: "active" },
            { name: "조인희", part: "soprano", status: "active" }, { name: "최경옥", part: "soprano", status: "active" },
            { name: "최지애", part: "soprano", status: "active" }, { name: "최주영", part: "soprano", status: "active" },
            { name: "하영애", part: "soprano", status: "active" }, { name: "한지연", part: "soprano", status: "active" },
            { name: "한정아", part: "soprano", status: "active" }, { name: "홍정희", part: "soprano", status: "active" },
            { name: "김경순", part: "alto", status: "active" }, { name: "김은정", part: "alto", status: "active" },
            { name: "김지영", part: "alto", status: "active" }, { name: "박연미", part: "alto", status: "active" },
            { name: "박은영", part: "alto", status: "active" }, { name: "반상순", part: "alto", status: "active" },
            { name: "심은주", part: "alto", status: "active" }, { name: "신지수", part: "alto", status: "active" },
            { name: "유인실", part: "alto", status: "active" }, { name: "이세인", part: "alto", status: "active" },
            { name: "이수미", part: "alto", status: "active" }, { name: "임선례", part: "alto", status: "active" },
            { name: "전주이", part: "alto", status: "active" },
            { name: "김상수", part: "tenor", status: "active" }, { name: "김성주", part: "tenor", status: "active" },
            { name: "김정경", part: "tenor", status: "active" }, { name: "노선호", part: "tenor", status: "active" },
            { name: "박경수", part: "tenor", status: "active" }, { name: "박임수", part: "tenor", status: "active" },
            { name: "소종욱", part: "tenor", status: "active" }, { name: "신성균", part: "tenor", status: "active" },
            { name: "오정근", part: "tenor", status: "active" }, { name: "우준호", part: "tenor", status: "active" },
            { name: "원치호", part: "tenor", status: "active" }, { name: "윤상수", part: "tenor", status: "active" },
            { name: "이효종", part: "tenor", status: "active" }, { name: "임설", part: "tenor", status: "active" },
            { name: "정윤조", part: "tenor", status: "active" }, { name: "조윤석", part: "tenor", status: "active" },
            { name: "최원영", part: "tenor", status: "active" }, { name: "홍용찬", part: "tenor", status: "active" },
            { name: "김두환", part: "bass", status: "active" }, { name: "김민석", part: "bass", status: "active" },
            { name: "김선덕", part: "bass", status: "active" }, { name: "김용수", part: "bass", status: "active" },
            { name: "김정민", part: "bass", status: "active" }, { name: "김진배", part: "bass", status: "active" },
            { name: "노영진", part: "bass", status: "active" }, { name: "박주완", part: "bass", status: "active" },
            { name: "서형주", part: "bass", status: "active" }, { name: "오상태", part: "bass", status: "active" },
            { name: "윤한숙", part: "bass", status: "active" },
            { name: "윤용중", part: "bass", status: "active" }, { name: "정운주", part: "bass", status: "active" },
            { name: "정지영", part: "bass", status: "active" }, { name: "조성천", part: "bass", status: "active" },
            { name: "주종성", part: "bass", status: "active" }, { name: "한구용", part: "bass", status: "active" },
            { name: "황성남", part: "bass", status: "active" }
        ];

        const PARTS = [
            { id: 'soprano', name: '소프라노', color: '#e91e63' },
            { id: 'alto', name: '알토', color: '#ff9800' },
            { id: 'tenor', name: '테너', color: '#2196f3' },
            { id: 'bass', name: '베이스', color: '#37474f' }
        ];

        // --- 1. 컴포넌트 선언 (App 이전에 배치하여 호이스팅 문제 방지) ---

        const ErrorBoundaryComp = ({ children }) => {
            const [hasError, setHasError] = useState(false);
            useEffect(() => {
                const handleError = (error) => { console.error(error); setHasError(true); };
                window.addEventListener('error', handleError);
                return () => window.removeEventListener('error', handleError);
            }, []);
            if (hasError) return <div className="flex flex-col items-center justify-center h-screen p-6 text-center text-left"><h1 className="text-xl font-bold text-red-600 mb-2">시스템 오류</h1><button onClick={() => window.location.reload()} className="bg-blue-600 text-white px-6 py-2 rounded-lg shadow-lg text-center">새로고침</button></div>;
            return children;
        };

        const NavBtn = ({ id, label, icon, active, onClick }) => (
            <button onClick={() => onClick(id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${active === id ? 'bg-blue-50 text-blue-600 font-bold shadow-sm' : 'text-gray-400 hover:bg-gray-50'} text-left`}>
                <i data-lucide={icon} className="w-5 h-5 text-left"></i>{label}
            </button>
        );

        const NavIconBtn = ({ id, icon, label, active, onClick }) => (
            <button onClick={() => onClick(id)} className={`flex flex-col items-center gap-1 transition-all ${active === id ? 'text-blue-600 scale-105' : 'text-gray-300'} text-center`}>
                <i data-lucide={icon} className="w-6 h-6 text-center"></i>
                <span className="text-[10px] font-black tracking-tighter uppercase text-center">{label}</span>
            </button>
        );

        const StatCard = ({ label, val, unit }) => (
            <div className="bg-white p-3 md:p-6 rounded-2xl md:rounded-3xl shadow-sm border border-gray-50 text-center flex flex-col justify-center">
                <div className="text-gray-400 text-[8px] md:text-[10px] font-black mb-1 uppercase tracking-widest text-center">{label}</div>
                <div className="text-lg md:text-4xl font-black text-[#4834d4] truncate text-center">{val}<span className="text-[10px] md:text-sm font-normal text-gray-300 ml-0.5 text-center">{unit}</span></div>
            </div>
        );

        const FilterTab = ({ active, onClick, label }) => (<button onClick={onClick} className={`px-3 py-1.5 rounded-full text-[10px] font-black tracking-tighter transition-all ${active ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-400 hover:bg-gray-200'} font-mono text-center`}>{label}</button>);

        const ManageView = ({ members, updateRoster, restoreInitial }) => {
            const [filterPart, setFilterPart] = useState('all');
            const sortedActive = useMemo(() => members?.filter(m => m.status === 'active' && (filterPart === 'all' || m.part === filterPart)).sort((a,b) => (a.name||'').localeCompare(b.name||'', 'ko')), [members, filterPart]);
            const sortedResting = useMemo(() => members?.filter(m => m.status !== 'active' && (filterPart === 'all' || m.part === filterPart)).sort((a,b) => (a.name||'').localeCompare(b.name||'', 'ko')), [members, filterPart]);

            return (
                <div className="space-y-6 pb-20 text-left fade-in">
                    <div className="flex justify-between items-end">
                        <div><h2 className="text-3xl font-black text-gray-800 tracking-tight">명단관리</h2><p className="text-gray-400 text-sm">대원 현황을 통합 관리합니다.</p></div>
                        <button onClick={restoreInitial} className="text-[10px] font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-full uppercase tracking-widest active:scale-95">명단 초기화</button>
                    </div>
                    <div className="flex flex-wrap items-center gap-1.5">
                        <FilterTab active={filterPart === 'all'} onClick={() => setFilterPart('all')} label="전체" />
                        <FilterTab active={filterPart === 'staff'} onClick={() => setFilterPart('staff')} label="성가사/반주자" />
                        {PARTS.map(p => ( <FilterTab key={p.id} active={filterPart === p.id} onClick={() => setFilterPart(p.id)} label={p.name} /> ))}
                    </div>
                    <div className="space-y-8">
                        {sortedResting?.length > 0 && (
                            <div className="space-y-3">
                                <h4 className="text-xs font-black text-red-500 uppercase tracking-widest flex items-center gap-2 px-1"><i data-lucide="moon" className="w-3 h-3"></i>휴식 중 대원 ({sortedResting.length}명)</h4>
                                <div className="bg-white rounded-3xl shadow-sm border-2 border-red-50 overflow-hidden divide-y divide-gray-50">
                                    {sortedResting.map(m => (
                                        <div key={m.name} className="flex items-center justify-between p-4 hover:bg-red-50/30 transition-colors">
                                            <div className="text-left font-mono"><div className="font-bold text-gray-400 text-sm">{m.name}</div><div className="text-[9px] font-black uppercase text-gray-300">{m.role || m.part}</div></div>
                                            <button onClick={() => updateRoster(members.map(x=>x.name===m.name?{...x,status:'active'}:x))} className="px-4 py-1.5 rounded-full text-[10px] font-black bg-gray-100 text-gray-400">복귀 처리</button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        <div className="space-y-3">
                            <h4 className="text-xs font-black text-gray-400 uppercase tracking-widest px-1">활동 중 대원 ({sortedActive?.length || 0}명)</h4>
                            <div className="bg-white rounded-3xl shadow-sm border border-gray-50 overflow-hidden divide-y divide-gray-50">
                                {sortedActive?.map(m => (
                                    <div key={m.name} className="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors">
                                        <div className="flex items-center gap-3">
                                            <div className="w-1.5 h-6 rounded-full" style={{ backgroundColor: m.part === 'staff' ? '#f59e0b' : PARTS.find(p=>p.id===m.part)?.color }}></div>
                                            <div className="text-left"><div className="font-bold text-gray-800 text-sm">{m.name}</div><div className="text-[9px] font-black uppercase text-gray-400">{m.role || m.part}</div></div>
                                        </div>
                                        <button onClick={() => updateRoster(members.map(x=>x.name===m.name?{...x,status:'inactive'}:x))} className="px-4 py-1.5 rounded-full text-[10px] font-black bg-green-100 text-green-600">활동 중</button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const MusicView = ({ list, onAuthRequired }) => {
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editTarget, setEditTarget] = useState(null);
            const [formData, setFormData] = useState({ date: new Date().toISOString().split('T')[0], title: '', cover: null, links: { soprano: '', alto: '', tenor: '', bass: '' } });
            const handleSubmit = async (e) => {
                e.preventDefault();
                const data = { ...formData };
                if (data.cover && data.cover.startsWith('data:image')) data.cover = await compressImage(data.cover);
                const colRef = window.MyFirebase.collection(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'music');
                if (editTarget) await window.MyFirebase.setDoc(window.MyFirebase.doc(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'music', editTarget.id), data);
                else await window.MyFirebase.addDoc(colRef, data);
                setIsModalOpen(false);
            };
            return (
                <div className="space-y-6 pb-10 fade-in text-left">
                    <div className="flex justify-between items-center px-1">
                        <h2 className="text-3xl font-black text-gray-800 tracking-tight">성가음원&악보</h2>
                        <button onClick={() => onAuthRequired(() => { setEditTarget(null); setFormData({date: new Date().toISOString().split('T')[0], title:'', cover:null, links:{soprano:'', alto:'', tenor:'', bass:''}}); setIsModalOpen(true); })} className="p-2 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 transition-colors"><i data-lucide="plus" className="w-6 h-6"></i></button>
                    </div>
                    <div className="grid gap-6">
                        {list.map(item => (
                            <div key={item.id} className="bg-white rounded-[32px] overflow-hidden shadow-sm border border-gray-50 flex flex-col">
                                <div className="h-48 bg-gray-100 overflow-hidden relative">
                                    {item.cover ? <img src={item.cover} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-gray-300"><i data-lucide="music" className="w-12 h-12"></i></div>}
                                    <div className="absolute top-4 right-4 flex gap-1">
                                        <button onClick={() => onAuthRequired(() => { setEditTarget(item); setFormData(item); setIsModalOpen(true); })} className="w-8 h-8 bg-white/90 rounded-full flex items-center justify-center text-gray-400 hover:text-blue-500 shadow-lg"><i data-lucide="pencil" className="w-4 h-4"></i></button>
                                        <button onClick={() => onAuthRequired(async () => { if(confirm("영구 삭제하시겠습니까?")) await window.MyFirebase.deleteDoc(window.MyFirebase.doc(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'music', item.id)); })} className="w-8 h-8 bg-white/90 rounded-full flex items-center justify-center text-gray-400 hover:text-red-500 shadow-lg"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                    </div>
                                </div>
                                <div className="p-6">
                                    <p className="text-[10px] text-gray-400 font-black uppercase mb-1">{item.date}</p>
                                    <h3 className="font-black text-gray-800 text-xl mb-4 leading-tight">{item.title}</h3>
                                    <div className="grid grid-cols-4 gap-2">
                                        {['soprano', 'alto', 'tenor', 'bass'].map(p => (
                                            <a key={p} href={item.links?.[p] || '#'} target={item.links?.[p] ? "_blank" : "_self"} className={`py-3 rounded-2xl text-xs font-black text-center transition-all ${item.links?.[p] ? 'bg-blue-50 text-blue-600 active:scale-95' : 'bg-gray-50 text-gray-300 pointer-events-none'}`}>
                                                {p.toUpperCase().slice(0,3)}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/60 z-[300] flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-white rounded-[32px] w-full max-w-md p-8 scale-in text-left">
                                <h3 className="font-black text-xl mb-6">찬양 정보 추가/수정</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <input type="date" value={formData.date} onChange={e=>setFormData({...formData, date:e.target.value})} className="w-full p-4 bg-gray-50 rounded-2xl font-bold" required />
                                    <input type="text" placeholder="곡 제목" value={formData.title} onChange={e=>setFormData({...formData, title:e.target.value})} className="w-full p-4 bg-gray-50 rounded-2xl font-bold" required />
                                    <input type="file" accept="image/*" onChange={e => { const f = e.target.files[0]; if(f){ const r=new FileReader(); r.onload=ev=>setFormData({...formData, cover:ev.target.result}); r.readAsDataURL(f); } }} className="w-full text-sm text-gray-400" />
                                    <div className="grid grid-cols-2 gap-2">
                                        {['soprano', 'alto', 'tenor', 'bass'].map(p => (
                                            <input key={p} type="url" placeholder={`${p} 링크`} value={formData.links[p]} onChange={e=>setFormData({...formData, links:{...formData.links, [p]:e.target.value}})} className="w-full p-3 bg-gray-50 rounded-xl text-xs" />
                                        ))}
                                    </div>
                                    <div className="flex gap-2 pt-4">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-4 bg-gray-100 rounded-2xl font-bold">취소</button>
                                        <button type="submit" className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg">저장</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const VideoView = ({ list, onAuthRequired }) => {
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editTarget, setEditTarget] = useState(null);
            const [formData, setFormData] = useState({ date: new Date().toISOString().split('T')[0], title: '', url: '' });
            const handleSubmit = async (e) => {
                e.preventDefault();
                const thumb = `https://img.youtube.com/vi/${extractYoutubeId(formData.url)}/mqdefault.jpg`;
                const data = { ...formData, thumbnail: thumb };
                const colRef = window.MyFirebase.collection(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'videos');
                if (editTarget) await window.MyFirebase.setDoc(window.MyFirebase.doc(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'videos', editTarget.id), data);
                else await window.MyFirebase.addDoc(colRef, data);
                setIsModalOpen(false);
            };
            return (
                <div className="space-y-6 pb-10 fade-in text-left">
                    <div className="flex justify-between items-center px-1">
                        <h2 className="text-3xl font-black text-gray-800 tracking-tight">찬양팀영상</h2>
                        <button onClick={() => onAuthRequired(()=>setIsModalOpen(true))} className="p-2 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 transition-colors"><i data-lucide="plus" className="w-6 h-6"></i></button>
                    </div>
                    <div className="grid gap-6">
                        {list.map(item => (
                            <div key={item.id} className="bg-white rounded-[32px] overflow-hidden shadow-sm border border-gray-50 cursor-pointer" onClick={() => window.open(item.url, '_blank')}>
                                <div className="aspect-video relative bg-gray-100">
                                    <img src={item.thumbnail} className="w-full h-full object-cover" />
                                    <div className="absolute inset-0 bg-black/10 flex items-center justify-center">
                                        <div className="w-14 h-14 bg-white/90 rounded-full flex items-center justify-center pl-1 shadow-2xl"><i data-lucide="play" className="w-6 h-6 text-red-600 fill-current"></i></div>
                                    </div>
                                </div>
                                <div className="p-6 flex justify-between items-start">
                                    <div className="min-w-0">
                                        <p className="text-[10px] text-gray-400 font-black uppercase mb-1">{item.date}</p>
                                        <h3 className="font-black text-gray-800 text-xl leading-tight line-clamp-2">{item.title}</h3>
                                    </div>
                                    <div className="flex gap-1" onClick={e => e.stopPropagation()}>
                                        <button onClick={() => onAuthRequired(() => { setEditTarget(item); setFormData(item); setIsModalOpen(true); })} className="p-2 text-gray-300 hover:text-blue-500 transition-colors"><i data-lucide="pencil" className="w-4 h-4"></i></button>
                                        <button onClick={() => onAuthRequired(async () => { if(confirm("영구 삭제하시겠습니까?")) await window.MyFirebase.deleteDoc(window.MyFirebase.doc(window.MyFirebase.db, 'artifacts', appId, 'public', 'data', 'videos', item.id)); })} className="p-2 text-gray-300 hover:text-red-500"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/60 z-[300] flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-white rounded-[32px] w-full max-w-md p-8 scale-in text-left">
                                <h3 className="font-black text-xl mb-6">영상 정보 추가/수정</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <input type="date" value={formData.date} onChange={e=>setFormData({...formData, date:e.target.value})} className="w-full p-4 bg-gray-50 rounded-2xl font-bold" required />
                                    <input type="text" placeholder="곡 제목" value={formData.title} onChange={e=>setFormData({...formData, title:e.target.value})} className="w-full p-4 bg-gray-50 rounded-2xl font-bold" required />
                                    <input type="url" placeholder="유튜브 링크" value={formData.url} onChange={e=>setFormData({...formData, url:e.target.value})} className="w-full p-4 bg-gray-50 rounded-2xl font-bold" required />
                                    <div className="flex gap-2 pt-4">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-4 bg-gray-100 rounded-2xl font-bold">취소</button>
                                        <button type="submit" className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg">저장</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const StatsView = ({ history, members, onEdit, onDelete, onInterestOpen, onGoToAttendance }) => {
            const chartRef = useRef(null); const chartInstance = useRef(null);
            const [filterType, setFilterType] = useState('all'); const [selectedId, setSelectedId] = useState(''); 
            const [selectedYear, setSelectedYear] = useState(new Date().getFullYear().toString());
            const filteredByYear = useMemo(() => history?.filter(h => h.date?.startsWith(selectedYear)) || [], [history, selectedYear]);

            useEffect(() => {
                if (filteredByYear.length > 0 && chartRef.current) {
                    if (chartInstance.current) chartInstance.current.destroy();
                    const sorted = [...filteredByYear].reverse();
                    let chartData = sorted.map(h => filterType==='all'?h.count:(filterType==='member'? (h.members?.includes(selectedId)?1:0) : h.members?.filter(m=>members.find(x=>x.name===m)?.part===selectedId).length));
                    chartInstance.current = new Chart(chartRef.current, {
                        type: filterType === 'member' ? 'bar' : 'line',
                        data: { labels: sorted.map(h => h.date.split('. ')[2] + '일'), datasets: [{ label:'출석', data: chartData, borderColor: '#4834d4', backgroundColor: 'rgba(72, 52, 212, 0.1)', fill: filterType !== 'member', tension: 0.4, pointRadius: 4 }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { display: false } } } }
                    });
                }
            }, [filteredByYear, filterType, selectedId]);

            return (
                <div className="space-y-6 pb-10 text-left fade-in">
                    <div className="flex justify-between items-center px-1">
                        <div className="flex items-center gap-2"><h2 className="text-3xl font-black text-gray-800 tracking-tight">출석현황판</h2><span className="text-sm font-black text-[#4834d4] pt-2">({members.length}명)</span></div>
                        <select value={selectedYear} onChange={(e) => setSelectedYear(e.target.value)} className="appearance-none bg-white border border-gray-200 text-gray-700 py-2 px-4 rounded-xl text-sm font-bold shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">{[...new Set(history.map(h => h.date.split('.')[0].trim()))].map(y => <option key={y} value={y}>{y}년</option>)}</select>
                    </div>
                    <div className="grid grid-cols-3 gap-2 md:gap-4 text-left">
                        <StatCard label="평균 출석" val={filteredByYear.length > 0 ? (filteredByYear.reduce((a,b)=>a+b.count, 0) / filteredByYear.length).toFixed(1) : 0} unit="명" />
                        <StatCard label="최다 출석" val={filteredByYear.length > 0 ? Math.max(...filteredByYear.map(h => h.count)) : 0} unit="명" />
                        <div onClick={onInterestOpen} className="bg-white p-3 md:p-6 rounded-2xl md:rounded-3xl shadow-sm border border-gray-50 text-center flex flex-col justify-center cursor-pointer hover:bg-orange-50/30 transition-colors group">
                            <div className="text-orange-500 text-[8px] md:text-[10px] font-black mb-1 uppercase tracking-widest flex items-center justify-center gap-1"><i data-lucide="alert-circle" className="w-2 md:w-3 h-2 md:h-3"></i> 관심 대원</div>
                            <div className="text-lg md:text-4xl font-black text-orange-600">?</div>
                        </div>
                    </div>
                    <div className="bg-white p-6 rounded-[32px] shadow-sm border border-gray-50 text-left">
                        <div className="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                            <div className="text-left"><h3 className="text-lg font-black text-gray-800 tracking-tight">{selectedYear}년 추이</h3></div>
                            <div className="flex flex-wrap items-center gap-1.5">
                                <FilterTab active={filterType === 'all'} onClick={() => {setFilterType('all'); setSelectedId('');}} label="전체" />
                                <FilterTab active={filterType === 'part'} onClick={() => {setFilterType('part'); setSelectedId('soprano');}} label="파트" />
                                <FilterTab active={filterType === 'member'} onClick={() => {setFilterType('member'); setSelectedId(members[0]?.name || '');}} label="개인" />
                            </div>
                        </div>
                        <div className="h-64 relative font-mono text-center">{filteredByYear.length > 0 ? <canvas ref={chartRef}></canvas> : <div className="h-full flex items-center justify-center text-gray-300 text-xs font-bold">No Data</div>}</div>
                    </div>
                    <div className="space-y-4 text-left">
                        <div className="flex items-center justify-between px-2">
                            <h3 className="text-lg font-black text-gray-800 tracking-tight">상세 출석 이력</h3>
                            <button onClick={onGoToAttendance} className="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full flex items-center gap-1 active:scale-95"><i data-lucide="plus" className="w-3 h-3"></i> 출석체크</button>
                        </div>
                        <div className="grid gap-3">
                            {filteredByYear.map(h => (
                                <div key={h.id} onClick={() => onEdit(h)} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex items-center justify-between hover:shadow-md transition-shadow cursor-pointer group">
                                    <div className="flex items-center gap-4 flex-1 min-w-0">
                                        <div className="w-14 h-14 bg-gray-50 rounded-xl overflow-hidden shrink-0 border border-gray-100 flex items-center justify-center text-center">
                                            {h.image ? <img src={h.image} className="w-full h-full object-cover text-center" /> : <i data-lucide="calendar" className="w-6 h-6 text-gray-200 text-center"></i>}
                                        </div>
                                        <div className="min-w-0 flex-1 text-left">
                                            <div className="font-bold text-gray-800 text-sm">{h.date}</div>
                                            <div className="text-[10px] text-gray-400 font-bold uppercase line-clamp-1 font-mono">{h.members?.join(', ')}</div>
                                        </div>
                                    </div>
                                    <div className="flex items-center shrink-0">
                                        <span className="text-sm font-black text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full whitespace-nowrap text-center text-center">{h.count}명</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const AttendanceView = ({ members, saveAttendance, attendanceMap, setAttendanceMap }) => {
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const activeMembers = members?.filter(m => m.status === 'active') || [];
            useEffect(() => { const map = {}; activeMembers.forEach(m => map[m.name] = true); setAttendanceMap(map); }, [members.length]);
            return (
                <div className="space-y-6 text-left pb-10">
                    <section className="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between text-left text-left">
                        <div className="text-left"><h2 className="text-3xl font-black text-gray-800 tracking-tight text-left">출석체크</h2><p className="text-gray-400 text-sm text-left">활동 대원은 기본적으로 모두 체크되어 있습니다.</p></div>
                        <div className="flex gap-2 w-full md:w-auto text-left text-left">
                            <input type="date" value={date} onChange={e=>setDate(e.target.value)} className="bg-white border-0 shadow-sm rounded-xl px-4 py-2 text-sm font-bold flex-1 outline-none" />
                            <button onClick={() => saveAttendance(date, Object.keys(attendanceMap), null)} className="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold shadow-lg transition-transform active:scale-95 text-center text-center">저장</button>
                        </div>
                    </section>
                    <section className="bg-white rounded-[32px] p-6 shadow-sm border border-gray-50 text-left">
                        {PARTS.map(part => {
                            const pList = activeMembers.filter(m => m.part === part.id);
                            return (
                                <div key={part.id} className="mb-8 last:mb-0 text-left">
                                    <h4 className="text-xs font-black text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><span className="w-1.5 h-3.5 rounded-full" style={{ backgroundColor: part.color }}></span>{part.name}</h4>
                                    <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
                                        {pList.map(m => (
                                            <button key={m.name} onClick={() => { const n = {...attendanceMap}; if(n[m.name]) delete n[m.name]; else n[m.name]=true; setAttendanceMap(n); }} className={`py-3 px-1 rounded-2xl text-[11px] font-bold transition-all border ${attendanceMap[m.name] ? 'bg-blue-600 border-blue-600 text-white' : 'bg-gray-50 border-gray-100 text-gray-400'}`}>{m.name}</button>
                                        ))}
                                    </div>
                                </div>
                            );
                        })}
                    </section>
                </div>
            );
        };

        const HistoryDetailModal = ({ record, allMembers, onClose, onSave, onDelete, isAuthenticated, requestAuth }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [selected, setSelected] = useState(new Set(record.members || []));
            const [image, setImage] = useState(record.image || null);
            const [isViewerOpen, setIsViewerOpen] = useState(false);
            const summary = useMemo(() => PARTS.map(p => ({ ...p, count: allMembers?.filter(m => m.part === p.id && selected.has(m.name)).length || 0 })), [selected, allMembers]);
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [isEditing, isViewerOpen]);

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4 text-left">
                    <div className="bg-white rounded-[32px] w-full max-w-lg h-[85vh] flex flex-col shadow-2xl scale-in overflow-hidden border border-gray-100">
                        <header className="p-6 border-b flex justify-between items-start shrink-0">
                            <div className="text-left text-left"><h3 className="text-xl font-black text-gray-800 tracking-tight text-left"> {record.date} 상세</h3><p className="text-[10px] text-gray-400 font-bold uppercase tracking-widest mt-0.5 font-mono text-left">Record ID: {record.id?.toString().slice(0,8)}</p></div>
                            <div className="flex items-center gap-2"><button onClick={() => requestAuth(() => setIsEditing(true))} className="p-2 text-blue-500 hover:bg-blue-50 rounded-full transition-colors"><i data-lucide="pencil" className="w-5 h-5"></i></button><button onClick={onClose} className="p-2 text-gray-300 hover:text-gray-600 text-left"><i data-lucide="x" className="w-6 h-6 text-left"></i></button></div>
                        </header>
                        <div className="px-6 py-4 bg-gray-50/50 border-b flex items-center justify-around shrink-0 gap-2 hide-scrollbar text-center text-center">
                            <div className="flex flex-col items-center text-center"><span className="text-[9px] font-black text-gray-400 uppercase">출석전체</span><span className="text-base font-black text-blue-600 font-mono">{selected.size}</span></div>
                            <div className="w-px h-6 bg-gray-200 text-center"></div>
                            {summary.map(p => (<div key={p.id} className="flex flex-col items-center text-center text-center"><span className="text-[9px] font-black text-gray-400 uppercase" style={{color: p.color}}>{p.name.slice(0,1)}</span><span className="text-xs font-black text-gray-700 font-mono text-center text-center">{p.count}</span></div>))}
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-6 hide-scrollbar text-left">
                            <section className="text-left"><h4 className="text-[10px] font-black text-gray-300 uppercase tracking-widest mb-3">배치도 / 사진</h4><div className="relative bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200 overflow-hidden min-h-[160px] flex items-center justify-center cursor-zoom-in text-center" onClick={() => image && setIsViewerOpen(true)}>{image ? <img src={image} className="w-full h-48 object-cover text-center mx-auto shadow-sm text-center" /> : <div className="text-gray-300 text-sm font-bold flex flex-col items-center gap-2"><i data-lucide="image" className="w-8 h-8 opacity-20"></i>사진 없음</div>}</div></section>
                            <section className="text-left"><h4 className="text-[10px] font-black text-gray-300 uppercase tracking-widest mb-4">참석 대원 명단</h4>
                                {PARTS.map(part => {
                                    const pMembers = allMembers?.filter(m => m.part === part.id && (m.status === 'active' || selected.has(m.name))) || [];
                                    return (
                                        <div key={part.id} className="mb-6 last:mb-0">
                                            <h5 className="text-[9px] font-black text-gray-400 mb-2 uppercase flex items-center gap-1.5"><span className="w-1 h-3 rounded-full text-left" style={{backgroundColor: part.color}}></span>{part.name}</h5>
                                            <div className="grid grid-cols-3 gap-1.5">
                                                {pMembers.map(m => ( <button key={m.name} onClick={() => { if(isEditing){ const n = new Set(selected); if(n.has(m.name)) n.delete(m.name); else n.add(m.name); setSelected(n); } }} className={`py-2.5 px-1 rounded-xl text-[11px] font-bold border transition-all ${selected.has(m.name) ? 'bg-blue-600 border-blue-600 text-white' : isEditing ? 'bg-gray-50 border-gray-100 text-gray-400' : 'bg-gray-50 border-gray-100 text-gray-300 pointer-events-none'}`}>{m.name}</button> ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </section>
                        </div>
                        {isEditing && (
                            <footer className="p-6 border-t bg-white flex items-center justify-between shrink-0 text-left text-left"><button onClick={() => { if(confirm("영구 삭제하시겠습니까?")) onDelete(record.id); }} className="text-red-400 font-black text-[10px] uppercase tracking-widest hover:text-red-600 transition-colors font-mono">Delete</button><div className="flex gap-2 text-left"><button onClick={() => setIsEditing(false)} className="px-5 py-3 bg-gray-50 border border-gray-100 rounded-2xl text-[10px] font-black text-gray-400 uppercase active:scale-95">Cancel</button><button onClick={() => onSave({...record, members: Array.from(selected), count: selected.size, image})} className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg active:scale-95">Save</button></div></footer>
                        )}
                    </div>
                    {isViewerOpen && (
                        <div className="fixed inset-0 bg-black/95 z-[300] flex flex-col items-center justify-center p-4 fade-in text-center text-center" onClick={() => setIsViewerOpen(false)}><div className="absolute top-6 right-6 text-white text-center text-center text-center"><button onClick={() => setIsViewerOpen(false)} className="p-4 hover:bg-white/10 rounded-full transition-colors text-center text-center text-center text-center"><i data-lucide="x" className="w-8 h-8 text-center text-center text-center"></i></button></div><img src={image} className="max-w-full max-h-[85vh] object-contain shadow-2xl scale-in text-center mx-auto text-center" onClick={(e) => e.stopPropagation()} /><p className="mt-6 text-gray-400 text-sm font-bold tracking-widest uppercase text-center text-center text-center">{record.date} 찬양팀 배치도</p></div>
                    )}
                </div>
            );
        };

        // --- 5. 메인 앱 컴포넌트 ---
        const App = () => {
            const [ready, setReady] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [showAuthOverlay, setShowAuthOverlay] = useState(false);
            const [authAction, setAuthAction] = useState(null);
            const [members, setMembers] = useState([]);
            const [history, setHistory] = useState([]);
            const [musicList, setMusicList] = useState([]);
            const [videoList, setVideoList] = useState([]);
            const [activeTab, setActiveTab] = useState('stats');
            const [toast, setToast] = useState({ show: false, msg: '' });
            const [modal, setModal] = useState({ isOpen: false, title: '', msg: '', onConfirm: null, image: null });
            const [attendanceMap, setAttendanceMap] = useState({});
            const [editingHistory, setEditingHistory] = useState(null);
            const [showInterestModal, setShowInterestModal] = useState(false);

            useEffect(() => {
                const waitFB = setInterval(() => { if (window.FB_READY && window.MyFirebase) { clearInterval(waitFB); startApp(); } }, 100);
                return () => clearInterval(waitFB);
            }, []);

            const startApp = async () => {
                const { auth, db, doc, collection, onSnapshot, setDoc, signInAnonymously, onAuthStateChanged } = window.MyFirebase;
                try {
                    await signInAnonymously(auth);
                    onAuthStateChanged(auth, (u) => {
                        if (u) {
                            setReady(true);
                            onSnapshot(doc(db, 'roster', 'current'), (s) => {
                                if (s.exists()) setMembers(s.data().list);
                                else { setDoc(doc(db, 'roster', 'current'), { list: INITIAL_MEMBERS }); setMembers(INITIAL_MEMBERS); }
                            });
                            onSnapshot(collection(db, 'history'), (s) => {
                                const list = []; s.forEach(d => list.push({ id: d.id, ...d.data() }));
                                list.sort((a, b) => new Date(b.date.replace(/\. /g, '-').replace(/\.$/, '')) - new Date(a.date.replace(/\. /g, '-').replace(/\.$/, '')));
                                setHistory(list);
                            });
                            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'music'), (s) => {
                                const list = []; s.forEach(d => list.push({ id: d.id, ...d.data() }));
                                list.sort((a, b) => new Date(b.date) - new Date(a.date));
                                setMusicList(list);
                            });
                            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'videos'), (s) => {
                                const list = []; s.forEach(d => list.push({ id: d.id, ...d.data() }));
                                list.sort((a, b) => new Date(b.date) - new Date(a.date));
                                setVideoList(list);
                            });
                        }
                    });
                } catch (e) { console.error(e); setReady(true); }
            };

            const onAuthSuccess = () => { setIsAuthenticated(true); localStorage.setItem('onnuri_auth', 'true'); setShowAuthOverlay(false); if (authAction) { authAction(); setAuthAction(null); } };
            const requestAuth = (action) => { setAuthAction(() => action); setShowAuthOverlay(true); };
            const showToast = (msg) => { setToast({ show: true, msg }); setTimeout(() => setToast({ show: false, msg: '' }), 3000); };
            const confirm = (title, msg, onConfirm, image = null) => setModal({ isOpen: true, title, msg, onConfirm, image });

            if (!ready) return <div className="h-screen flex items-center justify-center text-blue-600 font-black tracking-widest text-center text-center">Loading...</div>;

            return (
                <ErrorBoundaryComp>
                    <div className="flex h-screen bg-[#f8faff] overflow-hidden flex-col md:flex-row relative fade-in text-left">
                        <aside className="hidden md:flex flex-col w-64 bg-white border-r border-gray-100 p-6 z-10 shrink-0 text-left">
                            <div className="mb-10 text-left">
                                <h1 className="text-2xl font-black text-[#4834d4] tracking-tight text-left">주은혜 찬양사역팀</h1>
                                <div className="text-[10px] mt-1 text-gray-400 font-bold flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-green-500"></span>ONLINE</div>
                            </div>
                            <nav className="flex-1 space-y-2 text-left">
                                <NavBtn id="stats" label="출석현황판" icon="bar-chart-2" active={activeTab} onClick={setActiveTab} />
                                <NavBtn id="music" label="성가음원&악보" icon="music" active={activeTab} onClick={setActiveTab} />
                                <NavBtn id="video" label="찬양팀영상" icon="youtube" active={activeTab} onClick={setActiveTab} />
                                <button onClick={() => setActiveTab('manage')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'manage' ? 'bg-blue-50 text-blue-600 font-bold shadow-sm' : 'text-gray-400 hover:bg-gray-50'} text-left`}><i data-lucide="users" className="w-5 h-5"></i>명단관리</button>
                            </nav>
                        </aside>

                        <main className="flex-1 flex flex-col h-full overflow-hidden relative text-left">
                            <header className="md:hidden bg-white px-5 h-16 flex items-center justify-between border-b border-gray-100 shrink-0 text-left">
                                <span className="font-black text-lg text-[#4834d4]">주은혜 찬양사역팀</span>
                                <div className="flex items-center gap-2"><button onClick={() => setActiveTab('manage')} className={`p-2 ${activeTab==='manage'?'text-blue-500':'text-gray-400'}`}><i data-lucide="users" className="w-5 h-5"></i></button></div>
                            </header>
                            <div className="flex-1 overflow-y-auto p-4 md:p-10 pb-28 md:pb-10 hide-scrollbar text-left">
                                {activeTab === 'stats' && <StatsView history={history} members={members} onEdit={setEditingHistory} onInterestOpen={() => setShowInterestModal(true)} onGoToAttendance={() => setActiveTab('attendance')} />}
                                {activeTab === 'attendance' && <div className={!isAuthenticated ? "flex justify-center py-5 md:py-20 text-center" : ""}>{!isAuthenticated ? <AuthRequest onSuccess={onAuthSuccess} /> : <AttendanceView members={members} saveAttendance={(date,names)=>requestAuth(()=> { const formattedDate = date.replace(/-/g, '. ') + '.'; const record = { date: formattedDate, count: names.length, members: names, createdAt: new Date().toISOString() }; window.MyFirebase.addDoc(window.MyFirebase.collection(window.MyFirebase.db, 'history'), record); showToast("저장되었습니다."); setAttendanceMap({}); })} attendanceMap={attendanceMap} setAttendanceMap={setAttendanceMap} />}</div>}
                                {activeTab === 'manage' && <div className={!isAuthenticated ? "flex justify-center py-5 md:py-20 text-center" : ""}>{!isAuthenticated ? <AuthRequest onSuccess={onAuthSuccess} /> : <ManageView members={members} updateRoster={l => { setMembers(l); window.MyFirebase.setDoc(window.MyFirebase.doc(window.MyFirebase.db, 'roster', 'current'), {list: l}); showToast("저장됨"); }} restoreInitial={() => confirm("초기화", "명단을 복구하시겠습니까?", () => { setMembers(INITIAL_MEMBERS); window.MyFirebase.setDoc(window.MyFirebase.doc(window.MyFirebase.db, 'roster', 'current'), {list: INITIAL_MEMBERS}); showToast("명단 초기화 완료"); })} />}</div>}
                                {activeTab === 'music' && <MusicView list={musicList} onAuthRequired={requestAuth} />}
                                {activeTab === 'video' && <VideoView list={videoList} onAuthRequired={requestAuth} />}
                            </div>
                            <nav className="md:hidden fixed bottom-0 w-full h-20 bg-white border-t border-gray-100 flex items-center justify-around px-2 z-50 shadow-lg text-center text-center">
                                <NavIconBtn id="stats" icon="bar-chart-2" label="출석현황판" active={activeTab} onClick={setActiveTab} />
                                <NavIconBtn id="music" icon="music" label="성가음원&악보" active={activeTab} onClick={setActiveTab} />
                                <NavIconBtn id="video" icon="youtube" label="찬양팀영상" active={activeTab} onClick={setActiveTab} />
                            </nav>
                        </main>

                        {showAuthOverlay && <AuthOverlay masterPassword={MASTER_PASSWORD} onSuccess={onAuthSuccess} onClose={() => { setShowAuthOverlay(false); setAuthAction(null); }} />}
                        {editingHistory && <HistoryDetailModal record={editingHistory} allMembers={members} onClose={() => setEditingHistory(null)} onSave={async r => { await window.MyFirebase.setDoc(window.MyFirebase.doc(window.MyFirebase.db, 'history', r.id), r); showToast("수정됨"); setEditingHistory(null); }} onDelete={async id => { await window.MyFirebase.deleteDoc(window.MyFirebase.doc(window.MyFirebase.db, 'history', id)); showToast("삭제됨"); setEditingHistory(null); }} isAuthenticated={isAuthenticated} requestAuth={requestAuth} />}
                        {showInterestModal && <InterestModal members={members} history={history} onClose={() => setShowInterestModal(false)} />}
                        {modal.isOpen && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[220] flex items-center justify-center p-5 text-center"><div className="bg-white rounded-[32px] p-8 w-full max-w-sm shadow-2xl scale-in text-center border border-gray-100"><h3 className="text-xl font-black text-gray-800 tracking-tight mb-2 text-center">{modal.title}</h3><p className="text-gray-500 text-sm mb-4 leading-relaxed text-center">{modal.msg}</p><div className="flex gap-3 text-center text-center text-center text-center"><button onClick={() => setModal({ ...modal, isOpen: false })} className="flex-1 py-4 bg-gray-50 text-gray-400 font-bold rounded-2xl text-center">취소</button><button onClick={() => { modal.onConfirm(); setModal({ ...modal, isOpen: false }); }} className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg text-center">확인</button></div></div></div>
                        )}
                        {toast.show && <div className="fixed bottom-24 md:bottom-10 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full text-sm font-medium z-[400] shadow-2xl animate-bounce text-center text-center text-center">{toast.msg}</div>}
                    </div>
                </ErrorBoundaryComp>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
